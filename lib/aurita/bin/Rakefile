
require 'aurita'
require 'rake'

namespace :sys do
  task :restart => [ :stop, :start ] do
    puts 'Restarting aurita'
  end

  task :start do 
    mode = ARGV[0].intern if ARGV[0]
    mode ||= :production
    puts 'Starting aurita in ' << mode.to_s + ' mode'
    puts 'Deleting cache'
  end

  task :stop do
    puts 'Stopping aurita'
    puts 'Stopping webserver'
    puts 'Stopping FCGI daemons'
  end

  task :flush_logs do
    puts 'Flushing application log' 
    puts 'Flushing query log' 
  end

  task :flush => [ :stop, :flush_logs, :start] do
    puts 'Flushed'
  end

end

namespace :project do

  task :environment => [ :validate_args ] do
    Aurita.load_project(PROJECT_NAME.intern)
    PROJECT = Aurita.project
  end

  task :console => [ :environment ] do
    libs = " -r irb/completion -r aurita/lib/irb/console -r #{Aurita.project.base_path}env.rb"
    system("irb #{libs}")
    exit(1)
  end

  task :validate_args do
    if !ARGV[1] then
      puts 'Usage:  rake project:my_project <command>'
    end
    PROJECT_NAME = ARGV[1]
  end

end
